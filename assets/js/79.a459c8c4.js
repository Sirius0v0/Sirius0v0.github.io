(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{546:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"level-1-matlab-s-function编写入门"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#level-1-matlab-s-function编写入门"}},[t._v("#")]),t._v(" Level-1 Matlab S-Function编写入门")]),t._v(" "),a("p",[t._v("S-function包括主函数和6个功能子函数，包括"),a("code",[t._v("mdlInitializeSizes")]),t._v("（初始化）、"),a("code",[t._v("mdlDerivatives")]),t._v("（连续状态微分）、"),a("code",[t._v("mdlUpdate")]),t._v("（离散状态更新）、"),a("code",[t._v("mdlOutputs")]),t._v("（模块输出）、"),a("code",[t._v("mdlGetTimeOfNextVarHit")]),t._v("（计算下次采样时刻）和"),a("code",[t._v("mdlTerminate")]),t._v("（仿真结束）。")]),t._v(" "),a("p",[t._v("在S-function仿真过程中，利用"),a("code",[t._v("switch-case")]),t._v("语句，根据不同阶段对应的flag值来调用不同子函数，以完成对S-function模块仿真流程的控制。")]),t._v(" "),a("p",[t._v("Level-1 Matlab S-function仿真流程如下：\n"),a("center",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/Sirius0v0/image_store/blog/20230813134917.png",width:"45%/"}})])],1),t._v(" "),a("h2",{attrs:{id:"level-1-matlab-s-function函数的代码编写"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#level-1-matlab-s-function函数的代码编写"}},[t._v("#")]),t._v(" Level-1 Matlab S-Function函数的代码编写")]),t._v(" "),a("p",[t._v("可以利用命令打开一个示例代码：")]),t._v(" "),a("div",{staticClass:"language-matlab extra-class"},[a("pre",{pre:!0,attrs:{class:"language-matlab"}},[a("code",[t._v("edit sfuntmpl\n")])])]),a("h3",{attrs:{id:"函数原型及输入输出含义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#函数原型及输入输出含义"}},[t._v("#")]),t._v(" 函数原型及输入输出含义")]),t._v(" "),a("p",[t._v("函数原型如下：")]),t._v(" "),a("p",[a("code",[t._v("[sys,x0,str,ts,simStateCompliance] = SFUNC(t,x,u,flag,p1,...pn)")])]),t._v(" "),a("p",[a("code",[t._v("SFUNC")]),t._v("在给定时间点"),a("code",[t._v("t")]),t._v("返回的内容取决于"),a("code",[t._v("flag")]),t._v("的值、当前状态"),a("code",[t._v("x")]),t._v("、当前输入量"),a("code",[t._v("u")]),t._v("和可选输入参数"),a("code",[t._v("p1,...pn")]),t._v("，可选参数可以提供给S-Function，并且在任何FLAG操作期间使用。下面对"),a("code",[t._v("flag")]),t._v("的定义进行解释：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("FLAG")]),t._v(" "),a("th",[t._v("结果")]),t._v(" "),a("th",[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("0")]),t._v(" "),a("td",[t._v("[sizes, x0, str, Ts]")]),t._v(" "),a("td",[t._v("初始化，在sys返回系统大小，在x0初始化状态，在str中返回状态排序信息，在Ts中返回采样时间")])]),t._v(" "),a("tr",[a("td",[t._v("1")]),t._v(" "),a("td",[t._v("dx")]),t._v(" "),a("td",[t._v("返回在sys中的连续状态的微分")])]),t._v(" "),a("tr",[a("td",[t._v("2")]),t._v(" "),a("td",[t._v("ds")]),t._v(" "),a("td",[t._v("更新离散状态 sys = x(n+1)")])]),t._v(" "),a("tr",[a("td",[t._v("3")]),t._v(" "),a("td",[t._v("y")]),t._v(" "),a("td",[t._v("返回sys输出")])]),t._v(" "),a("tr",[a("td",[t._v("4")]),t._v(" "),a("td",[t._v("t_next")]),t._v(" "),a("td",[t._v("返回sys中下一采样时间点")])]),t._v(" "),a("tr",[a("td",[t._v("5")]),t._v(" "),a("td"),t._v(" "),a("td",[t._v("保留字")])]),t._v(" "),a("tr",[a("td",[t._v("9")]),t._v(" "),a("td",[t._v("[]")]),t._v(" "),a("td",[t._v("仿真结束，进行清理sys操作")])])])]),t._v(" "),a("p",[t._v("输出量：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("sys")]),t._v(" ： 一个通用的返回参数，返回值取决于flag的值；")]),t._v(" "),a("li",[a("code",[t._v("x0")]),t._v(" ：状态初始值；")]),t._v(" "),a("li",[a("code",[t._v("str")]),t._v(" ：默认为空，无需设置；")]),t._v(" "),a("li",[a("code",[t._v("ts")]),t._v(" ：采样时间，包含采样时间和偏移量；")]),t._v(" "),a("li",[a("code",[t._v("simStateComplicance")]),t._v(" ：附加变量。")])]),t._v(" "),a("h3",{attrs:{id:"如何使用可选参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何使用可选参数"}},[t._v("#")]),t._v(" 如何使用可选参数？")]),t._v(" "),a("p",[t._v("需要在使用可选参数的函数参数列表后加上定义即可。")]),t._v(" "),a("div",{staticClass:"language-matlab extra-class"},[a("pre",{pre:!0,attrs:{class:"language-matlab"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("sys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("x0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("simStateCompliance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("delay_and_gain_level1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("u"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("flag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("Ts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("gain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" flag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% 在需要使用可选参数的函数处加上参数即可")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("sys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("x0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("simStateCompliance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mdlInitializeSizes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Ts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    sys"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mdlDerivatives")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("u"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    sys"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mdlUpdate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("u"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    sys"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mdlOutputs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("u"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("gain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    sys"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mdlGetTimeOfNextVarHit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("u"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("Ts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    sys"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mdlTerminate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("u"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("otherwise")]),t._v("\n    DAStudio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Simulink:blocks:unhandledFlag'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("num2str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("flag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),a("h3",{attrs:{id:"flag-0-mdlinitializesizes函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flag-0-mdlinitializesizes函数"}},[t._v("#")]),t._v(" Flag 0: mdlInitializeSizes函数")]),t._v(" "),a("div",{staticClass:"language-matlab extra-class"},[a("pre",{pre:!0,attrs:{class:"language-matlab"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("sys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("x0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("simStateCompliance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mdlInitializeSizes\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% 示例中参数使用硬编码设置，推荐利用可选参数进行设置")]),t._v("\nsizes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" simsizes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% 以下四个参数可以被指定为-1，表示大小动态调整")]),t._v("\nsizes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NumContStates  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% 连续状态的数量")]),t._v("\nsizes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NumDiscStates  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% 离散状态的数量")]),t._v("\nsizes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NumOutputs     "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% 输出的数量")]),t._v("\nsizes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NumInputs      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% 输入的数量")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% 如果在FLAG=3调用期间使用u，则具有直接馈入")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% 将其设置为0类似于承诺在FLAG=3期间不会使用u；")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% 如果违反承诺，则会出现不可预测的结果。")]),t._v("\nsizes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DirFeedthrough "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% 输入端口是否具有直接馈入")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% 采样次数，应与下述ts的行数一致，一般为1")]),t._v("\nsizes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NumSampleTimes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nsys "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("simsizes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sizes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nx0  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nstr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nts  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% [采样时间，时间偏移]")]),t._v("\n\nsimStateCompliance "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'UnknownSimState'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% end mdlInitializeSizes")]),t._v("\n")])])]),a("h3",{attrs:{id:"flag-1-mdlderivatives函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flag-1-mdlderivatives函数"}},[t._v("#")]),t._v(" Flag 1: mdlDerivatives函数")]),t._v(" "),a("div",{staticClass:"language-matlab extra-class"},[a("pre",{pre:!0,attrs:{class:"language-matlab"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" sys"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mdlDerivatives")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("u"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% 设置对状态x的微分")]),t._v("\nsys "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% end mdlDerivatives")]),t._v("\n")])])]),a("h3",{attrs:{id:"flag-2-mdlupdate函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flag-2-mdlupdate函数"}},[t._v("#")]),t._v(" Flag 2: mdlUpdate函数")]),t._v(" "),a("div",{staticClass:"language-matlab extra-class"},[a("pre",{pre:!0,attrs:{class:"language-matlab"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" sys"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mdlUpdate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("u"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% 设置对离散状态x(n)的更新x(n+1)")]),t._v("\nsys "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% end mdlUpdate")]),t._v("\n")])])]),a("h3",{attrs:{id:"flag-3-mdloutputs函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flag-3-mdloutputs函数"}},[t._v("#")]),t._v(" Flag 3: mdlOutputs函数")]),t._v(" "),a("div",{staticClass:"language-matlab extra-class"},[a("pre",{pre:!0,attrs:{class:"language-matlab"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" sys"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mdlOutputs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("u"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% 设置系统输出y，该函数的x实则为x(n)")]),t._v("\nsys "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% end mdlOutputs")]),t._v("\n")])])]),a("h3",{attrs:{id:"flag-4-mdlgettimeofnextvarhit函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flag-4-mdlgettimeofnextvarhit函数"}},[t._v("#")]),t._v(" Flag 4: mdlGetTimeOfNextVarHit函数")]),t._v(" "),a("div",{staticClass:"language-matlab extra-class"},[a("pre",{pre:!0,attrs:{class:"language-matlab"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" sys"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mdlGetTimeOfNextVarHit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("u"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% 例如，如下设置则下一次执行该模块为1秒后")]),t._v("\nsampleTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsys "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" t "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" sampleTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% end mdlGetTimeOfNextVarHit")]),t._v("\n")])])]),a("h3",{attrs:{id:"flag-9-mdlterminate函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flag-9-mdlterminate函数"}},[t._v("#")]),t._v(" Flag 9: mdlTerminate函数")]),t._v(" "),a("div",{staticClass:"language-matlab extra-class"},[a("pre",{pre:!0,attrs:{class:"language-matlab"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" sys"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mdlTerminate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("u"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% 执行任何结束仿真后需要处理的任务")]),t._v("\nsys "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("% end mdlTerminate")]),t._v("\n")])])]),a("h3",{attrs:{id:"一些值得注意的点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一些值得注意的点"}},[t._v("#")]),t._v(" 一些值得注意的点")]),t._v(" "),a("ul",[a("li",[t._v("初始化函数中的参数尽可能使用可选参数设置的方式进行，尽量避免使用硬编码的手段；")]),t._v(" "),a("li",[t._v("参数列表中的x表示当前时刻的x(k)；")]),t._v(" "),a("li",[t._v("注意根据Flag=3: mdlOutputs函数中是否使用u，正确设置DirFeedthrough的值。")])]),t._v(" "),a("h2",{attrs:{id:"对s-function模块进行封装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对s-function模块进行封装"}},[t._v("#")]),t._v(" 对S-Function模块进行封装")]),t._v(" "),a("p",[t._v("在S-Function中如需设置可选参数，利用模块的封装可以更加清楚地展示所需参数并设置，本节将介绍封装的基本操作。")]),t._v(" "),a("ol",[a("li",[t._v("右击待封装的模块："),a("code",[t._v("Mask（封装）")]),t._v(" -> "),a("code",[t._v("Create Mask（创建封装）")]),t._v("；")]),t._v(" "),a("li",[t._v("在"),a("code",[t._v("Parameters & Dialog（参数和对话框）")]),t._v("中选择"),a("code",[t._v("Edit（编辑）")]),t._v("；")]),t._v(" "),a("li",[t._v("设置"),a("code",[t._v("Prompt（提示）")]),t._v("和"),a("code",[t._v("Name（名称）")]),t._v("并保存，其中Prompt为面板中的提示词，Name为可选参数变量名；")]),t._v(" "),a("li",[t._v("右击被封装系统：选择"),a("code",[t._v("Block Parameters（模块参数）")]),t._v("，在"),a("code",[t._v("S-Function参数")]),t._v("字段中设置相应的可选参数。")])])])}),[],!1,null,null,null);s.default=e.exports}}]);